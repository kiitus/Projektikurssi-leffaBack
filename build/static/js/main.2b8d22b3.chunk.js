(this["webpackJsonpleffaapp-frontend"]=this["webpackJsonpleffaapp-frontend"]||[]).push([[0],{32:function(e,t,a){e.exports=a(64)},64:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),l=a(30),o=a.n(l),i=a(6),c=a(15),u=a(7),s=function(e){var t=e.review;return r.a.createElement("div",{style:{margin:20}},r.a.createElement("div",null,r.a.createElement("b",null,"Rating:")," ",t.rating),r.a.createElement("div",null,r.a.createElement("b",null,"Review: ")," ",t.review),r.a.createElement("div",null,r.a.createElement("b",null,"Author:")," ",t.user,"  ",t.date))},m=function(e){var t=e.movie,a=e.selectToShow,n=e.toShow,l=e.average,o=function(e){var n=t.reviews.reduce((function(e,t){return e+t.rating}),0)/t.reviews.length;n=n.toFixed(1),a({title:e,average:n})},i={clear:"both",cursor:"pointer"},c={verticalAlign:"text-top"};return n!==t.Title?r.a.createElement("h3",{onClick:function(){return o(t.Title)},style:i},t.Title," ",t.Year):n===t.Title?r.a.createElement("div",null,r.a.createElement("table",null,r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("td",{style:c},r.a.createElement("h3",{onClick:function(){return o(t.Title)},style:i},t.Title," ",t.Year),r.a.createElement("div",{style:{display:"inline-block",float:"left",marginRight:100}},r.a.createElement("img",{src:t.Poster,alt:"Poster"}))),r.a.createElement("td",{style:c},r.a.createElement("div",{style:{marginLeft:100,textAlignVertical:"top"}}),r.a.createElement("h2",null,"IMDB-rating:",t.imdb),r.a.createElement("h2",null,"Average-rating:",l),t.reviews.map((function(e,t){return r.a.createElement(s,{key:t,review:e})}))))))):void 0},v=function(e){var t=e.movies,a=Object(n.useState)(null),l=Object(i.a)(a,2),o=l[0],c=l[1],u=Object(n.useState)(null),s=Object(i.a)(u,2),v=s[0],p=s[1],E=function(e){e.title===o?c(null):(c(e.title),p(e.average))};return r.a.createElement("div",{style:{margin:20}},r.a.createElement("h2",null,"Movies"),r.a.createElement("div",{style:{marginLeft:20,marginTop:10}},t.map((function(e,t){return r.a.createElement(m,{key:t,movie:e,toShow:o,selectToShow:E,average:v})}))))},p=a(3),E=a(14),d=function(e){var t=e.movie,a=e.getReview,l=Object(n.useState)(5),o=Object(i.a)(l,2),c=o[0],u=o[1],s=Object(n.useState)(""),m=Object(i.a)(s,2),v=m[0],d=m[1],f=Object(n.useState)(!1),h=Object(i.a)(f,2),g=h[0],b=h[1];return null===t?null:r.a.createElement("div",null,r.a.createElement("h2",{style:{marginLeft:50}},t.Title," ",t.Year),r.a.createElement("div",{style:{display:"inline-block",float:"left",marginRight:110,marginLeft:50}},r.a.createElement("h3",null,"IMDB-rating:",t.imdbRating),r.a.createElement("p",null,r.a.createElement("img",{src:t.Poster,alt:"Poster"}))),r.a.createElement("h2",null,"Review movie"),r.a.createElement(p.a,{onSubmit:function(e){if(e.preventDefault(),v.length>3){b(!0);var n={Title:t.Title,Year:t.Year,Poster:t.Poster,imdb:t.imdbRating,reviews:[]};n.reviews.push({rating:c,review:v}),a(n),u(5),d(""),setTimeout((function(){b(!1)}),1e3)}}},r.a.createElement(p.a.Group,{controlId:"reviewTextarea"},r.a.createElement(p.a.Row,null,r.a.createElement(p.a.Label,null,"Rating"),r.a.createElement("input",{type:"number",min:"0",max:"10",value:c,step:"0.1",onChange:function(e){var t=e.target;u(t.value)},required:!0})),r.a.createElement(p.a.Row,null,r.a.createElement(p.a.Label,null,"Write a review"),r.a.createElement(p.a.Control,{placeholder:"Write your review here ( min 4 letters)",as:"textarea",rows:"17",value:v,onChange:function(e){var t=e.target;return d(t.value)}}),r.a.createElement(E.a,{className:"float-right",variant:"primary",type:"submit",disabled:g},"Save review")))))},f=function(e){var t=e.getLoginInformation,a=Object(n.useState)(""),l=Object(i.a)(a,2),o=l[0],c=l[1],u=Object(n.useState)(""),s=Object(i.a)(u,2),m=s[0],v=s[1];return r.a.createElement("div",null,r.a.createElement(p.a,{style:{margin:22},onSubmit:function(e){e.preventDefault(),t(o,m),c(""),v("")}},r.a.createElement(p.a.Group,{controlId:"formBasicEmail"},r.a.createElement(p.a.Label,null,"Username:"),r.a.createElement(p.a.Control,{type:"text",placeholder:"Enter username",value:o,onChange:function(e){var t=e.target;return c(t.value)}})),r.a.createElement(p.a.Group,{controlId:"formBasicPassword"},r.a.createElement(p.a.Label,null,"Password:"),r.a.createElement(p.a.Control,{type:"password",placeholder:"Enter password",value:m,name:"Password",onChange:function(e){var t=e.target;return v(t.value)}})),r.a.createElement(E.a,{variant:"primary",type:"submit"},"Login")))},h={margin:20},g=function(e){var t=e.amount;return r.a.createElement("div",{style:h},r.a.createElement("h2",null,"Welcome to use THE REVIEWER"),r.a.createElement("p",null,"This is an app for reading and writing reviews for movies. You can read reviews without signing in, but to write a review you must make an account for the site. You will see the reviews by cliking the title of the movie"),r.a.createElement("p",null,"There are ",t," movies reviewed in the site"),r.a.createElement("p",null,r.a.createElement("b",null,"When you test the site, please write some sensible review")),r.a.createElement("p",null,"The site has been made using React, Axios, Json web token, Node.js (express) and MongoDB (mongoose)."),r.a.createElement("p",null,"Github repo can be found ",r.a.createElement("a",{href:"https://github.com/kiitus/Projektikurssi-leffaBack"},r.a.createElement("b",null,"here"))),r.a.createElement("h3",{style:{paddingTop:"30px"}},"My other projects are:"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("a",{href:"https://teemun.herokuapp.com/"},"Class reservation application")," which repo is ",r.a.createElement("a",{href:"https://github.com/kiitus/ht-reservationHandlebars"},"HERE")),r.a.createElement("li",null,r.a.createElement("a",{href:"https://webshopsql.herokuapp.com/"},"Webshop application")," which repo is ",r.a.createElement("a",{href:"https://github.com/kiitus/webshop_psql"},"HERE"))))},b=function(e){var t=e.getSignUpIformation,a=Object(n.useState)(""),l=Object(i.a)(a,2),o=l[0],c=l[1],u=Object(n.useState)(""),s=Object(i.a)(u,2),m=s[0],v=s[1],d=Object(n.useState)(""),f=Object(i.a)(d,2),h=f[0],g=f[1];return r.a.createElement("div",null,r.a.createElement(p.a,{style:{margin:22},onSubmit:function(e){e.preventDefault(),console.log(t(o,m,h)),c(""),v(""),g("")}},r.a.createElement(p.a.Group,{controlId:"formBasicEmail"},r.a.createElement(p.a.Label,null,"Username:"),r.a.createElement(p.a.Control,{type:"text",placeholder:"Enter username",value:o,onChange:function(e){var t=e.target;return c(t.value)}})),r.a.createElement(p.a.Group,{controlId:"formBasicPassword"},r.a.createElement(p.a.Label,null,"Password:"),r.a.createElement(p.a.Control,{type:"password",placeholder:"Enter password",value:m,name:"Password",onChange:function(e){var t=e.target;return v(t.value)}})),r.a.createElement(p.a.Group,{controlId:"formBasicPassword2"},r.a.createElement(p.a.Label,null,"Password:"),r.a.createElement(p.a.Control,{type:"password",placeholder:"Enter same password",value:h,name:"Password2",onChange:function(e){var t=e.target;return g(t.value)}})),r.a.createElement(E.a,{variant:"primary",type:"submit"},"Sign up")))},w=function(e){var t=e.message;return null===t?null:r.a.createElement("div",{style:{color:"red",margin:10}},t)},y=function(e){var t=e.getSearchedTitle,a=Object(n.useState)(""),l=Object(i.a)(a,2),o=l[0],c=l[1];return r.a.createElement(p.a,{style:{marginRight:10,marginTop:20},onSubmit:function(e){e.preventDefault(),t(o),c("")}},r.a.createElement(p.a.Group,{controlId:"formBasicMovie"},r.a.createElement(p.a.Label,null,"Search movie to review:"),r.a.createElement(p.a.Control,{type:"text",placeholder:"Title of the movie",value:o,name:"search",onChange:function(e){var t=e.target;return c(t.value)}})),r.a.createElement(E.a,{variant:"primary",type:"submit"},"Seach movie"))},S=a(12),T=a.n(S),j=null,O=function(e){j="bearer ".concat(e)},k=function(){return T.a.get("/api/movies").then((function(e){return e.data}))},I=function(e){var t={headers:{Authorization:j}};return T.a.get("".concat("/api/movies","/").concat(e),t).then((function(e){return e.data}))},C=function(e){var t="https://www.omdbapi.com/?t=".concat(e,"&apikey=").concat("d20392f7");return T.a.get(t).then((function(e){return e}))},R=function(e){return T.a.post("/api/login",e).then((function(e){return e.data}))},L=function(e){return T.a.post("/api/users",e).then((function(e){return e.data}))},P=null,x=function(e){P="bearer ".concat(e)},A=function(e){var t={headers:{Authorization:P}};return T.a.post("/api/reviews",e,t).then((function(e){return e.data}))},B=function(e,t){var a={headers:{Authorization:P}};return console.log(a),T.a.put("".concat("/api/reviews","/").concat(e),t,a).then((function(e){return e.data}))},Y=function(){var e=Object(n.useState)([]),t=Object(i.a)(e,2),a=t[0],l=t[1],o=Object(n.useState)(null),s=Object(i.a)(o,2),m=s[0],p=s[1],E=Object(n.useState)(null),h=Object(i.a)(E,2),S=h[0],T=h[1],j=Object(n.useState)(null),P=Object(i.a)(j,2),Y=P[0],G=P[1],U=Object(n.useState)([]),D=Object(i.a)(U,2),M=D[0],N=D[1],_=function(e,t){return e.Title>t.Title?1:t.Title>e.Title?-1:0};Object(n.useEffect)((function(){k().then((function(e){e.sort(_),l(e)}))}),[]),Object(n.useEffect)((function(){var e=window.localStorage.getItem("loggedAppUser");if(e){var t=JSON.parse(e);console.log(t),T(t),x(t.token),O(t.token),t&&I(t.id).then((function(e){null!==e&&(e.movies.sort(_),N(e.movies))})).catch((function(e){G("".concat(e.response.data.message)),setTimeout((function(){G(null)}),6e3),W()}))}}),[]);var W=function(){window.localStorage.removeItem("loggedAppUser"),T(null),x(null),O(null),N([]),p(null)},H=function(e){C(e).then((function(e){"False"!==e.data.Response?p(e.data):p(null)})).catch((function(e){console.log(e)}))},J=function(e){var t=M.findIndex((function(t){return t.Title===e.Title})),n=a.findIndex((function(t){return t.Title===e.Title})),r=-1;-1!==t?(r=M[t].reviews.findIndex((function(e){return e.user===S.username})),window.confirm("You have already reviewed this movie. Update the review?")&&B(M[t].reviews[r].id,e.reviews[0]).then((function(e){var o=M.concat(),i=a.concat();o[t].reviews[r]=e,i[n].reviews[r]=e,N(o),l(i)})).catch((function(e){G("".concat(e.response.data.message)),setTimeout((function(){G(null)}),6e3),W()}))):-1===t&&A(e).then((function(t){if(-1===n){e.reviews.length=0,e.reviews.push(t);var r=a.concat(e);r.sort(_),l(r)}else{var o=a.concat();o[n].reviews.push(t),l(o)}var i;(i=-1===n?M.concat(e):M.concat(a[n])).sort(_),N(i)})).catch((function(e){G("".concat(e.response.data.message)),setTimeout((function(){G(null)}),6e3),W()})),p(null)},q=function(e,t){R({username:e,password:t}).then((function(e){window.localStorage.setItem("loggedAppUser",JSON.stringify(e)),x(e.token),O(e.token),I(e.id).then((function(e){e.movies.sort(_),N(e.movies)})),T(e)})).catch((function(e){G("".concat(e.response.data.error)),setTimeout((function(){G(null)}),6e3)}))},z={padding:15};return r.a.createElement("div",{className:"container"},r.a.createElement(c.a,null,r.a.createElement("div",null,r.a.createElement(c.b,{style:z,to:"/"},"home"),r.a.createElement(c.b,{style:z,to:"/reviews"},"all reviews"),r.a.createElement(c.b,{style:z,to:"/your_reviews"},"movies reviewed by you"),r.a.createElement(c.b,{style:z,to:"/make_review"},"make review"),S?null:r.a.createElement(c.b,{style:z,to:"/sign_up"},"Sign up"),S?r.a.createElement("em",null,S.username," logged in ",r.a.createElement("button",{onClick:W}," Logout")):r.a.createElement("span",null,"You are not logged in")),r.a.createElement(w,{message:Y}),r.a.createElement(u.c,null,r.a.createElement(u.a,{path:"/sign_up"},S?r.a.createElement("div",null,r.a.createElement(y,{getSearchedTitle:H}),r.a.createElement(d,{movie:m,getReview:J})):r.a.createElement("div",null,r.a.createElement(b,{getSignUpIformation:function(e,t,a){if(t!==a)return G("Passwords didn't match"),setTimeout((function(){G(null)}),6e3),!1;L({userName:e,password:t}).then((function(e){q(e.userName,t)})).catch((function(e){return console.log(e.response),G(e.response.data.message),setTimeout((function(){G(null)}),6e3),!1}))}}))),r.a.createElement(u.a,{path:"/reviews"},r.a.createElement(v,{movies:a})),r.a.createElement(u.a,{path:"/your_reviews"},S?r.a.createElement(v,{movies:M}):r.a.createElement("div",null,r.a.createElement(f,{getLoginInformation:q}))),r.a.createElement(u.a,{path:"/make_review"},S?r.a.createElement("div",null,r.a.createElement(y,{getSearchedTitle:H}),r.a.createElement(d,{movie:m,getReview:J})):r.a.createElement("div",null,r.a.createElement(f,{getLoginInformation:q}))),r.a.createElement(u.a,{path:"/login"},r.a.createElement(f,{getLoginInformation:q})),r.a.createElement(u.a,{path:"/"},r.a.createElement(g,{amount:a.length})))),r.a.createElement("footer",{style:{clear:"both",marginTop:40,bottom:0,padding:20,backgroundColor:"grey"}},r.a.createElement("i",null,"Teemu Hallinen, Ohjelmistosuunnittelu t\xe4ydennyskoulutus SeAMK 2019-2020")))};o.a.render(r.a.createElement(Y,null),document.getElementById("root"))}},[[32,1,2]]]);
//# sourceMappingURL=main.2b8d22b3.chunk.js.map